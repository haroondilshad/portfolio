<!-- Simplified head.html to fix mixed content issues and optimize performance -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

{{- if hugo.IsProduction | or (eq site.Params.env "production") | and (ne .Params.robotsNoIndex true) }}
<meta name="robots" content="index, follow">
{{- else }}
<meta name="robots" content="noindex, nofollow">
{{- end }}

{{- $title := ( .Title ) }}
{{- $siteTitle := ( site.Title ) }}
{{- if .IsHome }}
{{ $title = $siteTitle }}
{{- else }}
{{ $title = printf "%s | %s" .Title $siteTitle }}
{{- end }}

<title>{{ $title }}</title>

<meta name="title" content="{{ $title }}">
{{- if .Description }}
<meta name="description" content="{{ .Description }}">
{{- else if .Summary }}
<meta name="description" content="{{ .Summary }}">
{{- else if .Params.summary }}
<meta name="description" content="{{ .Params.summary }}">
{{- else if site.Params.description }}
<meta name="description" content="{{ site.Params.description }}">
{{- end }}

<meta name="keywords" content="{{ (delimit .Keywords " ") }}">
<meta name="author" content="{{ (partial "author.html" . ) }}">
<link rel="canonical" href="{{ .Permalink }}">

{{- if site.Params.analytics.google.SiteVerificationTag }}
<meta name="google-site-verification" content="{{ site.Params.analytics.google.SiteVerificationTag }}">
{{- end }}

{{- /* Favicon - Fixed HTTPS URLs */ -}}
<link rel="icon" href="{{ site.BaseURL }}favicon/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="{{ site.BaseURL }}favicon/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="{{ site.BaseURL }}favicon/favicon-32x32.png">
<link rel="apple-touch-icon" href="{{ site.BaseURL }}favicon/apple-touch-icon.png">
<link rel="manifest" href="{{ site.BaseURL }}favicon/site.webmanifest">

{{- /* Preload critical resources for better performance */ -}}
{{- if eq .Kind "home" }}
<!-- Preload WebP version for modern browsers -->
<link rel="preload" href="{{ site.BaseURL }}profile.webp" as="image" type="image/webp" fetchpriority="high">
<!-- Preload JPEG fallback -->
<link rel="preload" href="{{ site.BaseURL }}profile.jpeg" as="image" type="image/jpeg" fetchpriority="high">
{{- end }}

{{- with .OutputFormats.Get "rss" -}}
{{ printf `<link rel="%s" type="%s" href="%s" title="%s">` .Rel .MediaType.Type .Permalink site.Title | safeHTML }}
{{- end }}

{{- if hugo.IsProduction | or (eq site.Params.env "production") }}
{{- template "_internal/google_analytics.html" . }}
{{- end }}